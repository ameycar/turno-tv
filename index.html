<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Turnos - Centro Médico DR. Luis Quito</title>
  <link rel="stylesheet" href="../style.css" />
  <style>
    body {
      display: flex;
      height: 100vh;
      background-color: #f4f6f9;
      color: #222;
      overflow: hidden;
      font-family: "Poppins", sans-serif;
    }

    /* Video a la izquierda */
    .video-container {
      flex: 2;
      background: black;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Panel de turnos a la derecha */
    .panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 1rem;
      background: linear-gradient(180deg, #004aad, #007fff);
      color: white;
    }

    .titulo {
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
    }

    .turno-actual {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      background-color: white;
      color: #004aad;
      border-radius: 20px;
      box-shadow: 0 0 15px rgba(255,255,255,0.3);
      margin: 10px 0;
      padding: 20px;
    }

    .ultimos {
      background-color: rgba(255,255,255,0.2);
      border-radius: 15px;
      padding: 10px;
      overflow-y: auto;
    }

    .ultimos h3 {
      margin: 0;
      font-size: 1.2rem;
      border-bottom: 2px solid white;
      padding-bottom: 5px;
    }

    .ultimos ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .ultimos li {
      padding: 5px 0;
      border-bottom: 1px solid rgba(255,255,255,0.3);
    }

  </style>
</head>
<body>
  <!-- Video -->
  <div class="video-container">
    <video autoplay loop muted>
      <source src="video.mp4" type="video/mp4" />
      Tu navegador no soporta video.
    </video>
  </div>

  <!-- Panel lateral -->
  <div class="panel">
    <div class="titulo">
      Centro Médico DR. Luis Quito<br />
      <span id="nombreSede">Cargando sede...</span>
    </div>

    <div class="turno-actual" id="turnoActual">
      Esperando pacientes...
    </div>

    <div class="ultimos">
      <h3>Últimos llamados</h3>
      <ul id="ultimosLlamados"></ul>
    </div>
  </div>

  <audio id="sonido" src="notificacion.mp3" preload="auto"></audio>

  <script type="module">
    import { db } from "../firebase-config.js";
    import { ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // ✅ Definir sede actual (puede venir de la URL o configurarse fija)
    const sedeActual = "Vitarte 1"; // ← cámbiala si este TV es de otra sede
    document.getElementById("nombreSede").textContent = sedeActual;

    const turnoActual = document.getElementById("turnoActual");
    const ultimosLlamados = document.getElementById("ultimosLlamados");
    const sonido = document.getElementById("sonido");

    const llamadoRef = ref(db, `llamados/${sedeActual}`);

    // Escuchar nuevos llamados
    onValue(llamadoRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) return;

      const nombreCompleto = `${data.nombres} ${data.apellidos}`;
      const area = data.area || "consultorio";

      // 🖥️ Mostrar en pantalla
      turnoActual.textContent = `${nombreCompleto}`;
      turnoActual.style.background = "white";
      turnoActual.style.color = "#004aad";

      // 🔔 Reproducir sonido
      sonido.play().catch(() => {});

      // 🗣️ Voz en pantalla
      const utterance = new SpeechSynthesisUtterance(
        `Siguiente turno: ${nombreCompleto}, área de ${area}`
      );
      utterance.lang = "es-ES";
      utterance.rate = 0.9;
      speechSynthesis.speak(utterance);

      // 🕓 Registrar en lista inferior
      const li = document.createElement("li");
      li.textContent = `${nombreCompleto} - ${area} (${data.hora})`;
      ultimosLlamados.prepend(li);

      // Mantener solo los 5 últimos
      while (ultimosLlamados.children.length > 5) {
        ultimosLlamados.removeChild(ultimosLlamados.lastChild);
      }
    });
  </script>
</body>
</html>
